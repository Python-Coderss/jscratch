# Java-based Scratch-like Web Application with Python Block Support

## Project Description

This project is a web application that provides a simplified, Scratch-like visual programming environment. Users can add Python code blocks to a script assembly area and execute them. The frontend is built with HTML, CSS, and vanilla JavaScript, while the backend is a lightweight Java HTTP server responsible for executing the Python code.

The primary goal is to explore the integration of a visual block metaphor with Python scripting, executed server-side.

## Features (Current State)

*   **Web-Based Interface:** Accessible via a modern web browser.
*   **Three-Panel Layout:**
    *   **Block Palette:** Contains available blocks (currently "Python Code Block" and "Say Block").
    *   **Script Assembly Area:** Where a single chosen block (Python or Say) is configured.
    *   **Stage Area:** Displays the output from the executed program.
*   **Block Types:**
    *   **Python Code Block:**
        *   A clickable block in the palette.
        *   Opens a modal dialog to input or edit Python code.
        *   Python code is executed using an **embedded Jython interpreter** within the Java server.
    *   **Say Block:**
        *   A clickable block in the palette.
        *   Prompts the user for text input.
        *   The "said" text is displayed in the Stage Area, simulated by the server.
*   **Program Execution:**
    *   A "Run Program" button triggers the execution of the configured block.
    *   The frontend sends a **JSON payload** to the backend describing the block to execute (e.g., its type and code/text).
    *   The Java backend parses this JSON and dispatches to the appropriate execution logic (Jython for Python blocks, specific Java handling for Say blocks).
    *   Output (from Python or simulated by Say block) is returned to the frontend and displayed.
*   **Server-Side Operations:**
    *   Java HTTP server handles static file serving for the frontend and API requests.
    *   Server-side logging (`server.log`) records requests, script executions, and errors.
*   **Basic Script Runner (Legacy):** The server also retains a `/run/<script_name>` endpoint for executing pre-existing shell scripts from the `scripts/` directory (this uses external process execution, not Jython).

## Directory Structure

-   `src/main/java/com/example/SimpleHttpServer.java`: The core Java code for the backend HTTP server, including request handlers.
-   `src/main/java/com/example/JythonExecutor.java`: Class responsible for executing Python code using the embedded Jython interpreter.
-   `webapp/`: Contains all frontend files (`index.html`, `style.css`, `js/app.js`).
-   `scripts/`: Holds example shell scripts (`hello.sh`, `list_files.sh`, etc.) for the legacy `/run/` endpoint. (Note: The `/api/execute_program` endpoint for UI-driven Python execution now uses Jython and does not save temporary files here.)
-   `lib/`: This directory is for JAR dependencies. **You must create this directory and place the Jython Standalone JAR here.**
-   `server.log`: Log file generated by the Java server.
-   `out/` (Optional, created during build): Default directory for compiled Java class files.

## Prerequisites

*   **Java JDK 8 or higher:** Required to compile and run the Java server code.
*   **Jython Standalone JAR:** Required for executing Python blocks from the web UI. Place this in the `lib/` directory.
*   **Python 3 Interpreter (Optional, for legacy script runner):** If you intend to use the `/run/<script_name>` endpoint with Python scripts (e.g. `.py` with a shebang), then a CPython interpreter (python3 or python) must be in the system's PATH. This is **not** used for Python blocks added via the UI.
*   **Web Browser:** A modern web browser to access the application.

### Jython Setup

The web UI's Python Code Blocks are executed using Jython, which runs Python code directly within the Java Virtual Machine.

1.  **Create `lib` Directory:** If it doesn't already exist, create a directory named `lib` in the root of this project.
2.  **Download Jython:**
    *   Go to the [Jython official website](https://www.jython.org/download).
    *   Download the "Jython Standalone" JAR file (e.g., `jython-standalone-2.7.3.jar` or a newer compatible version).
3.  **Place JAR in `lib/`:** Copy the downloaded `jython-standalone-X.Y.Z.jar` into the `lib/` directory you created. **Ensure the filename here matches the one used in the compile/run commands below.**

1.  **Create `lib` Directory:** If it doesn't already exist, create a directory named `lib` in the root of this project.
2.  **Download Jython:**
    *   Go to the [Jython official website](https://www.jython.org/download).
    *   Download the "Jython Standalone" JAR file (e.g., `jython-standalone-2.7.3.jar`).
3.  **Place JAR in `lib/`:** Copy the downloaded `jython-standalone-X.Y.Z.jar` into the `lib/` directory you created.

## How to Build and Run

1.  **Ensure `lib` directory and Jython JAR are set up as described above.**
2.  **Compile the Java Server:**
    Open a terminal or command prompt, navigate to the project's root directory. Create an `out` directory if it doesn't exist (`mkdir -p out`). Then, run the compilation command, adjusting the Jython JAR filename if yours is different:

    *   **Linux/macOS (colon classpath separator):**
        ```bash
        javac -cp "lib/jython-standalone-2.7.3.jar" -d out src/main/java/com/example/JythonExecutor.java src/main/java/com/example/SimpleHttpServer.java
        ```
    *   **Windows (semicolon classpath separator):**
        ```bash
        javac -cp "lib\jython-standalone-2.7.3.jar" -d out src\main\java\com\example\JythonExecutor.java src\main\java\com\example\SimpleHttpServer.java
        ```
    *(Note: The server will not be able to execute Python blocks from the UI without this JAR and correct classpath setup.)*

3.  **Run the Java Server:**
    After successful compilation, run the server using (adjust the Jython JAR filename and classpath separator for your OS):

    *   **Linux/macOS:**
        ```bash
        java -cp "lib/jython-standalone-2.7.3.jar:out" com.example.SimpleHttpServer
        ```
    *   **Windows:**
        ```bash
        java -cp "lib\jython-standalone-2.7.3.jar;out" com.example.SimpleHttpServer
        ```
    The server will start, and you should see log messages in your console (and in `server.log`) indicating it's running on port 8000.

3.  **Access the Application:**
    Open your web browser and navigate to:
    `http://localhost:8000/`

## How to Use (Current Functionality)

1.  **Open the Web Page:** Navigate to `http://localhost:8000/` in your browser.
2.  **Choose a Block:**
    *   In the "Block Palette" on the left, click either the "Python Code Block" or the "Say Block".
3.  **Configure the Block:**
    *   **Python Code Block:** A modal dialog will appear. Enter your Python code into the textarea and click "Save Python."
    *   **Say Block:** A prompt dialog will appear. Enter the text you want the "program" to "say" and click "OK."
4.  **View Assembled Block:** The chosen and configured block (e.g., "Python Block (Code Saved)" or "Say: \"your text\"") will appear in the "Script Assembly Area," replacing any block that was previously there.
5.  **Run the Program:**
    *   Click the "Run Program" button, located at the top of the "Script Assembly Area".
6.  **See Output:**
    *   **For Python Block:** The output from your Python script (including `print()` statements or any error messages from Jython) will be displayed in the "Stage" area.
    *   **For Say Block:** A message like `[Output] SAY: your text` will be displayed in the "Stage" area.

## Known Issues & Limitations

*   **Single Block Execution:** The interface currently supports only one active block (either Python or Say) at a time. Adding a new block replaces the previous one.
*   **No Visual Scripting Metaphor:** There is no actual dragging, dropping, or connecting of blocks. Interaction is via modals or prompts.
*   **Basic Error Reporting:** Python script errors (via Jython) are displayed but might not be as detailed as a full Python IDE.
*   **No State Persistence:** Code or text entered is not saved if you refresh the page.
*   **Security of `/run/` endpoint:** The legacy `/run/<script_name>` endpoint directly executes scripts from the `scripts/` directory by name using external processes. Ensure only trusted scripts are placed there if this endpoint is used. The `/api/execute_program` endpoint for UI blocks now uses Jython.

## Future Ideas

*   Implement true drag-and-drop for blocks from the palette to the assembly area.
*   Support for multiple blocks and defining a sequence of execution.
*   Introduce more Scratch-like standard blocks (e.g., loops, conditionals, variables) that could potentially wrap or interact with Python code.
*   Visual representation of script flow.
*   Saving and loading user-created programs/scripts.
*   More sophisticated error handling and debugging features.

## Design and Architecture

The current execution model for code submitted from the web UI (via the `/api/execute_program` endpoint) uses a JSON payload to define the program (currently a single block) and Jython to run Python code blocks directly within the Java server. For a more Scratch-like experience with multiple, interconnected blocks, a more comprehensive program execution architecture is envisioned.

This architecture involves:
-   An enhanced JSON-based representation of the program (sequence of blocks) sent from the frontend.
-   A backend `ProgramOrchestrator` to parse this JSON and manage block-by-block execution.
-   Mapping "Standard Blocks" (e.g., "Say", "Move") to specific Java methods.
-   Executing "Python Blocks" using the `JythonExecutor`.
-   A shared `ProgramContext` object for state management (variables, output) accessible by all blocks.

Detailed conceptual notes on this program execution architecture, including JSON structure, block type handling, state management, and output collection, can be found in [DESIGN_NOTES.md](./DESIGN_NOTES.md).
